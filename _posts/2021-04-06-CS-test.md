---
layout: post
title:  "칼만 필터는 어렵지 않아"
subtitle:   "서브타이틀"
categories: CS
tags: algo2
comments: true
---

# 칼만필터는 어렵지않아

## 평균 필터

배치식 : 데이터를 한번에 모아 계산

⇒ 아주 멍청한 방식 , 이런식의 필터는 패기처분

재귀식 : 이전 결과값을 이용하여 계산 **(재귀식과 재귀함수는 다르다)
⇒ 계산 효율이 배치식보다 좋음 ,  메모리 공간 효율도 좋음**

![%E1%84%8F%E1%85%A1%E1%86%AF%E1%84%86%E1%85%A1%E1%86%AB%E1%84%91%E1%85%B5%E1%86%AF%E1%84%90%E1%85%A5%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%85%E1%85%A7%E1%86%B8%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%A1%E1%86%AD%E1%84%8B%E1%85%A1%20a76be9a2f30c48c9bf6b6bb11d5f8886/Untitled.png](%E1%84%8F%E1%85%A1%E1%86%AF%E1%84%86%E1%85%A1%E1%86%AB%E1%84%91%E1%85%B5%E1%86%AF%E1%84%90%E1%85%A5%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%85%E1%85%A7%E1%86%B8%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%A1%E1%86%AD%E1%84%8B%E1%85%A1%20a76be9a2f30c48c9bf6b6bb11d5f8886/Untitled.png)

![%E1%84%8F%E1%85%A1%E1%86%AF%E1%84%86%E1%85%A1%E1%86%AB%E1%84%91%E1%85%B5%E1%86%AF%E1%84%90%E1%85%A5%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%85%E1%85%A7%E1%86%B8%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%A1%E1%86%AD%E1%84%8B%E1%85%A1%20a76be9a2f30c48c9bf6b6bb11d5f8886/Untitled%201.png](%E1%84%8F%E1%85%A1%E1%86%AF%E1%84%86%E1%85%A1%E1%86%AB%E1%84%91%E1%85%B5%E1%86%AF%E1%84%90%E1%85%A5%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%85%E1%85%A7%E1%86%B8%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%A1%E1%86%AD%E1%84%8B%E1%85%A1%20a76be9a2f30c48c9bf6b6bb11d5f8886/Untitled%201.png)

이 때 a는 데이터 개수 k 에 의해 정해진다.

- 평균계산 , 센서 초기화(영점 조절)에 사용됨 (평균 필터를 통해 측정 데이터의 잡음을 제거 할 수 있다)
⇒ **동적 시스템 (시간에 따라 변화)은 반영할 수 없음**

```python
def AvgFilter(val,pre_avg): #데이터수,값,평균
	alpha = (k-1)/k
	avg = alpha*pre_avg + (1-alpha)*val
	return avg

```

## 이동평균 필터

모든 데이터의 평균이 아닌 오래된 측정값을 버리는 평균 필터

- 측정한 물리량이 시간에 따라 변하는 경우 (동적 시스템) 잡음을 없애는 방법 중 하나

⇒ **평균 필터와는 다르게 n개의 최근 데이터를 저장해야 하므로 메모리 저장공간이 절약되는 이점은 없음**

- 데이터 개수(n)가 많으면 시간 지연이 발생,  잡음 제거 효과 상승

![%E1%84%8F%E1%85%A1%E1%86%AF%E1%84%86%E1%85%A1%E1%86%AB%E1%84%91%E1%85%B5%E1%86%AF%E1%84%90%E1%85%A5%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%85%E1%85%A7%E1%86%B8%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%A1%E1%86%AD%E1%84%8B%E1%85%A1%20a76be9a2f30c48c9bf6b6bb11d5f8886/Untitled%202.png](%E1%84%8F%E1%85%A1%E1%86%AF%E1%84%86%E1%85%A1%E1%86%AB%E1%84%91%E1%85%B5%E1%86%AF%E1%84%90%E1%85%A5%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%85%E1%85%A7%E1%86%B8%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%A1%E1%86%AD%E1%84%8B%E1%85%A1%20a76be9a2f30c48c9bf6b6bb11d5f8886/Untitled%202.png)

```python
import numpy as np
def MovAvgFilter(n_val,val):
	n = len(n_val)
	for i in range(n-1):
			n_val[i] = n_val[i+1]
	n_val[n-1] = val
	mvag = np.mea(n_val)
	return mvag,n_val
```

## 저주파 통과 필터 (Low pass filter)

저주파만 통과 시키는 필터 ( 잡음은 고주파이므로 잡음 걸러내는데 쓰임)

⇒ 영상처리에서도 배웠다 싶이 종류가 매우 많음 이 섹션에선 **1차 저주파 통과 필터( 지수 가중 이동평균 필터)** 를 다룸

- 이동 평균 필터는 모든 데이터에 같은 가중치(1/n)를 부여 하므로 성능이 좋지 못함 (즉, 오래된 데이터와 최근의 데이터의 가중치가 동일)

![%E1%84%8F%E1%85%A1%E1%86%AF%E1%84%86%E1%85%A1%E1%86%AB%E1%84%91%E1%85%B5%E1%86%AF%E1%84%90%E1%85%A5%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%85%E1%85%A7%E1%86%B8%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%A1%E1%86%AD%E1%84%8B%E1%85%A1%20a76be9a2f30c48c9bf6b6bb11d5f8886/Untitled%203.png](%E1%84%8F%E1%85%A1%E1%86%AF%E1%84%86%E1%85%A1%E1%86%AB%E1%84%91%E1%85%B5%E1%86%AF%E1%84%90%E1%85%A5%E1%84%82%E1%85%B3%E1%86%AB%20%E1%84%8B%E1%85%A5%E1%84%85%E1%85%A7%E1%86%B8%E1%84%8C%E1%85%B5%E1%84%8B%E1%85%A1%E1%86%AD%E1%84%8B%E1%85%A1%20a76be9a2f30c48c9bf6b6bb11d5f8886/Untitled%203.png)

평균필터와 다르게 a는 임의로 지정 한 값

⇒ 점화식을 풀어보면 이전값 일수록 1보다작은 a값이 여러번 곱해지므로 오래된 값의 가중치는 작아진다.

- 측정 데이터의 상황에 맞게 a를 선정해야함 a를 잘못 선정하게 되면 이동평균필터보다 시간지연이 더 많이 생길수도 있음.
- **a가 크면 잡음은 줄어들고 시간지연이 커짐**

```python
def LowPassFilter(val,est,alpha):
	est = alpha * est + ( 1 - alpha) * val
	return est	
```

## 칼만 필터
